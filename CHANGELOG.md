2020-11-28
2020-12-03
2020-12-06
2020-12-07
2020-12-09 - Изменил размер пакета для версии 4.9
2020-12-11 - При ХХ отображается только РХХ, 
				ДПДЗ отображается при положении газа более 2%.
			- Поменял шрифты температуры ОЖ и РХХ.
			- Добавил пороги для значений и их индикацию.
2021-01-05 - Добавил возможность отображения AFR вместо напряжения.
			- Добавил пороги для напряжения.
			- Добавил возможность выбора числа импульсов датчика 
				скорости на 1 км.
2021-02-19 - Добавил экран замера разгона 0-100.
2021-04-25 - Изменил размер пакета для версии 4.9 от 14.04.2021
2021-06-20 - Добавил сигнализацию превышения скорости (колокольчик AE86). 
2021-07-27 - Добавил экран ошибок CE.
2021-09-28 - Исправил размер пакета для версии 4.8. Вынес в настройки скорость порта.
2021-10-03 - Добавил автоматическое переключение вывода АФР или напряжение УДК.
			- Добавил возможность вывода оборотов на семисегментный дисплей на TM1637.
			- Увеличил частоту обновления экрана.
			- Добавил в настройки скорость обновления экрана.
2021-10-04 - Исправил баг с переполнением буфера незадействованных параметров,
				которые имели значение "7FFF".
			- Добавил ограничения значений для всех параметров.
2021-10-05 - Исправил еще один баг с переполнением буфера теперь уже для параметров, 
				которые хранятся в EEPROM. Во-первых, неверно указал длину строки для пробега
				и израсходованного топлива, во-вторых забыл, что на новой Ардуино в EEPROM
				могут быть не обязательно нули.
========================================================================================
	Переход на версию 2
========================================================================================
2021-10-06 - Разбил все показания на экране на отдельные блоки. Сделал конфигуратор экрана в Excel.
2021-10-07 - Отсортировал и поделил на группы переменные и функции.
		   	- Добавил второй экран.
		   	- Добавил блоки для отображения: 
				* обороты (F),
				* уровень топлива (F), 
				* EGT (F),
				* Давление масла (F).
2021-10-08 - Вынес в отдельные файлы:
				* Название ошибок CE в CE_Errors.h,
				* Настроки в Configuration.h,
				* Глобальные переменные в Global_Variables.h,
				* Пиктограммы в Pictograms.h.
			- Наделал кучу новых багов и героически с ними сражался,
		   	- Сделал автоопределение размера пакета от SECU,
		   	- Добавил второй экран с данными.
		   	- Добавил блоки для отображения:
		   		* ДАД2, давление газа (F),
		   		* Дифф.давление, ДАД2-ДАД (F),
		   		* Темп. 2, температура газа (F),
		   		* Загрузка форсунок (F).
2021-10-09 - Добавил блок номера расхода воздуха.
2021-10-11 - Добавил в настройки шаг регулировки яркости (BRIGHT_STEP),
			- Добавил блоки для отображения:
 				* Напряжение сети (F),
				* Напряжение УДК / AFR (F),
				* Температура воздуха на впуске (F),
				* Средний расход топлива суточный (F),
				* Средний расход топлива общий (F).
2021-10-15 - Добавил анимацию включения для дисплея TM1637.
			- Добавил возможность выбора данных для отображения для TM1637:
				* Обороты,
				* EGT,
				* AFR,
				* Загрузка форсунок,
				* ДАД.
2021-10-19 - Немного оптимизировал код.
			- Посчитал максимальный объем ОЗУ, используемый 
				локальными переменными - 77 байт.
2021-10-21 - Добавил счетчик моточасов и блок для отображения.
			- Добавил линейный тахометр на экран замера разгона.
			- Немного поправил отрисовку некоторых блоков.
			- Исправил баг с зависанием дисплея TM1637 при переключении экранов.
2021-11-04 - Добавил управление кнопками, энкодер остается как опция.
2021-11-05 - Добавил два режима яркости в зависимости от состояния габаритов.
			- Добавил плавное изменение яркости.
			- Добавил блок отображение яркости при изменении значения.
			- Питание БК теперь постоянное с мониторингом состояния замка зажигания.
2021-11-06 - Добавил управление подсветкой приборной панели.
				Яркость приборной панели регулируется на дополнительном экране.
2021-11-08 - Добавил экран завершения.
2021-11-11 - Уменьшил количество использованных шрифтов, это осовободило 2,5 КБ flash памяти.
			- Исправил несколько ошибок в коде новых функций.
2021-11-21 - Добавил управление питанием, после завершения БК сам себя выключает через MOSFET.
2021-11-27 - Изменил расчет израсходованного топлива, теперь топливо учитывается в мл,
				Так как расчет топлива происходил на пределе точности float.
2021-11-28 - Исправил расчет средней скорости на экране завершения.
2021-12-01 - Добавил буфер уровня топлива, настраивается с помощью FUEL_TANK_LEVEL_AVG.
			- Экран завершения отображается только если пройдено больше 100м.
2021-12-03 - Исправил режим подсветки и начальные показания топлива при старте БК.
2021-12-10 - Исправил баг экрана и управления питания, который появлялся 
				при быстром выключении и включении зажигания (перезапуск двигателя)
2021-12-14 - Добавил замер разгона 60-100.
2021-12-17 - Добавил большой блок лямбда коррекции.
2022-01-06 - Добавил коэффициент коррекции расхода топлива. 
2022-01-28 - Добавил автоматическую регулировку яркости подсветки.
			- Убрал картинку на заставке из-за нехватки flash памяти.
			- Изменил процесс загрузки БК, сначала определяется длина пакета,
				далее принимается первый пакет, после всего этого уже идет заставка.
				Если нет данных в течение 3-х секунд на экран выводится сообщение "NO SIGNAL".
2022-02-01 - Исправил несколько ошибок анимации при старте.
			- Привязал яркость сегментного дисплея к яркости LCD.
			- Отключил неиспользуемые выводы при автояркости и при использовании энкодера.
2022-02-02 - Добавил вывод для индикации низкого уровня топлива.
2022-02-03 - Оптимизировал код, убрал все лишнее для освобождения flash памяти.
			- Заменил библиотеку Arduino EEPROM на avr/eeprom.h.
2022-02-04 - Добавил анимацию смены экранов.
			- Добавил плавное изменение автояркости.
2022-02-05 - Добавил датчик температуры DS18B20.
			- Исправил ошибку с вычислением расхода топлива в гц (переполнение int).
2022-02-07 - Исправил ошибку со случайным срабатыванием длинного нажатия при
				анимиции смены экрана.
2022-02-25 - Изменил анимацию смены экранов.
			- Добавил программный сброс при повторном запуске БК до отключения питания.
2022-02-27 - Добавил проверку контрольной суммы для пакета данных.
2022-06-06 - Добавил большой блок уровня ШИМ вентилятора охлаждения.
2022-07-22 - Исправил баг при перезапуске БК, при котором счетчик израсходованного
				топлива сбрасывался, а пробег оставался, так как она хранится в SECU.
2022-10-05 - Добавил функцию проверки датчика аварийного давления масла.
				При старте БК проверяется исправность цепи, далее контролируется состояние.
2022-11-21 - Увеличил максимальный размер пакета с 90 до 100 байт для версии SECU 5.0.
2023-02-17 - Добавил возможность подключения датчика EGT напрямую к БК, если на SECU
				закончились выводы. Датчик EGT - термопара тип К,
				для усиления сигнала я исползовал операционный усилитель LM358.
2023-04-18 - Обновил код для новой версии SECU от 23.03.2023.
				Изменен алгоритм расчета скорости, пробега и израсходованного топлива.
				Теперь коэффициент коррекции расхода топлива можно настраивать
				на экране разгона аналогично яркости экрана.
2023-08-27 - Исправил ошибки при работе с энкодером.
				Добавил возможность сброса EEPROM при старте БК с помощью удержания
				кнопки "Вправо".
				При удержание кнопки "Влево" в EEPROM запишутся значения из прошивки.
2024-01-02 - Исправил ошибку при сбросе одометра в менеджере.
			- Мгновенный расход топлива в л/100км теперь отображается если скорость > 3 км/ч,
				положение ДПДЗ не учитывается.
			- Добавил блоки для отображения:
 				* AFR Mix (F)
 				* AFR Mix (H)
 				* AFR № 2 (F)
 				* AFR № 2 (H)
 				* AFR Целевой (F)
 				* AFR Целевой (H)
 				* Лямбда коррекция № 2 (F)
 				* Лямбда коррекция № 2 (H)
 				* Состав смеси в % от целевового значения Лямбда № 1 (F)
 				* Состав смеси в % от целевового значения Лямбда № 1 (H)
 				* Состав смеси в % от целевового значения Лямбда № 1+2 (F)
 				* Состав смеси в % от целевового значения Лямбда № 1+2 (H)
 				* Состав смеси в % от целевового значения Лямбда № 2 (F)
 				* Состав смеси в % от целевового значения Лямбда № 2 (H)
 				* Температура воздуха на впуске с учетом ТОЖ (F)
 				* Температура воздуха на впуске с учетом ТОЖ (H)
2024-06-30 - Добавил сторожевую собаку.
========================================================================================
	Переход на AVR C
========================================================================================


ПЛАН:
 - Дисплей на MAX7219.
*/
